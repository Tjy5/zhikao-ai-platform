系统设计文档 (SDD): 智考公考伴侣
版本: V1.1 (MVP 阶段)
日期: 2025年9月5日
关联文档: 《智考公考伴侣 - 产品需求文档 V1.1》

1. 引言
本文档旨在为“智考公考伴侣” MVP 版本的开发提供全面的技术设计方案。它将基于 PRD V1.1 中定义的功能需求，详细阐述系统架构、技术选型、模块设计、API 接口、数据库结构以及核心 AI 服务的实现思路。

2. 系统架构
为确保系统的可扩展性、可维护性和开发效率，我们将采用前后端分离的微服务架构，并部署于云平台。

2.1 架构图 (MVP)
Parse error on line 2:
...TD    subgraph 用户端 (Client)        A[W
----------------------^
Expecting 'SEMI', 'NEWLINE', 'SPACE', 'EOF', 'GRAPH', 'DIR', 'subgraph', 'SQS', 'end', 'AMP', 'COLON', 'START_LINK', 'STYLE', 'LINKSTYLE', 'CLASSDEF', 'CLASS', 'CLICK', 'DOWN', 'UP', 'NUM', 'NODE_STRING', 'BRKT', 'MINUS', 'MULT', 'UNICODE_TEXT', got 'PS'
2.2 架构说明
用户端 (Client): 负责用户交互和界面展示，通过 API 网关与后端通信。
API 网关 (API Gateway): 统一的请求入口，负责路由、认证、限流。
后端微服务 (Backend Microservices):
用户服务: 核心职责是用户身份认证和个人信息管理。
学习与题库服务: 负责 MVP 的核心业务逻辑，包括智能诊断、学习计划、题库练习、错题本和学习报告。
申论服务: 负责处理申论文章的提交、存储，并与 AI 服务交互获取批改结果。
AI 服务 (AI Services):
智能诊断与推荐服务: 执行能力评估算法，并根据结果生成学习建议。
申论批改服务: 异步处理申论批改请求，执行 NLP 算法进行分析。
数据存储 (Data Storage):
PostgreSQL: 主数据库，存储所有核心业务数据。
Redis: 用于缓存用户会话、热点数据，提升性能。
对象存储: 存储用户上传的申论手写稿图片等大文件。
3. 技术栈选型
前端: React.js + Next.js (TypeScript)
移动端: React Native (TypeScript)
后端: Python 3.10+ & FastAPI
数据库: PostgreSQL
缓存: Redis
AI/ML: PyTorch / TensorFlow, Hugging Face Transformers
容器化: Docker
部署: 阿里云 / AWS / 腾讯云 (使用 Kubernetes 进行容器编排)
4. 模块设计与 API 接口
所有 API 接口都将遵循 RESTful 风格，并使用 JWT (JSON Web Token) 进行认证。

4.1 用户服务 (User Service)
职责: 用户注册、登录、个人信息管理。
核心 API Endpoints:
POST /api/v1/auth/register (用户注册)
POST /api/v1/auth/login (用户登录)
GET /api/v1/users/me (获取当前用户信息)
PUT /api/v1/users/me (更新当前用户信息)
4.2 学习与题库服务 (Learning & QuestionBank Service)
职责: 智能诊断、学习计划、题库练习、错题本、学习报告。
核心 API Endpoints:
GET /api/v1/diagnosis/start (开始诊断测试，返回题目列表)
POST /api/v1/diagnosis/submit (提交诊断结果，生成报告)
GET /api/v1/plans/current (获取当前学习计划)
POST /api/v1/tasks/{task_id}/complete (完成学习任务)
GET /api/v1/practice/special (获取专项练习题目)
POST /api/v1/practice/submit (提交练习答案，记录错题)
GET /api/v1/wrong-questions (获取错题列表)
GET /api/v1/analytics/dashboard (获取学习数据面板信息)
4.3 申论服务 (Shenlun Service)
职责: 申论文章提交、批改结果查询、范文管理。
核心 API Endpoints:
POST /api/v1/shenlun/submit (提交申论文章)
GET /api/v1/shenlun/submissions/{submission_id} (查询申论提交及批改结果)
GET /api/v1/shenlun/templates (获取高分范文列表)
5. 数据库设计 (PostgreSQL)
以下是 MVP 阶段的核心数据表结构设计。

users (用户表)

id (UUID, PK)
phone_number (VARCHAR, UNIQUE)
password_hash (VARCHAR)
nickname (VARCHAR)
avatar_url (VARCHAR)
target_province (VARCHAR)
created_at (TIMESTAMP WITH TIME ZONE)
questions (题目表)

id (UUID, PK)
content (TEXT)
type (VARCHAR, e.g., 'SINGLE_CHOICE')
module (VARCHAR, e.g., 'QUANTITATIVE_RELATIONS')
knowledge_point (VARCHAR)
options (JSONB) - [{"id": "A", "text": "..."}, ...]
answer (JSONB) - {"correct_option_id": "A", "analysis": "..."}
difficulty (INTEGER)
practice_records (练习记录表)

id (UUID, PK)
user_id (UUID, FK to users.id)
question_id (UUID, FK to questions.id)
user_answer (VARCHAR)
is_correct (BOOLEAN)
created_at (TIMESTAMP WITH TIME ZONE)
wrong_questions (错题本表)

id (UUID, PK)
user_id (UUID, FK to users.id)
question_id (UUID, FK to questions.id)
review_count (INTEGER, DEFAULT 0)
added_at (TIMESTAMP WITH TIME ZONE)
learning_plans (学习计划表)

id (UUID, PK)
user_id (UUID, FK to users.id, UNIQUE)
status (VARCHAR, e.g., 'ACTIVE')
created_at (TIMESTAMP WITH TIME ZONE)
learning_tasks (学习任务表)

id (UUID, PK)
plan_id (UUID, FK to learning_plans.id)
task_date (DATE)
type (VARCHAR, e.g., 'PRACTICE', 'REVIEW')
content (JSONB) - {"module": "...", "count": 20}
status (VARCHAR, e.g., 'PENDING', 'COMPLETED')
shenlun_submissions (申论提交表)

id (UUID, PK)
user_id (UUID, FK to users.id)
title (VARCHAR)
material (TEXT)
user_answer_text (TEXT)
handwriting_image_url (VARCHAR, nullable)
status (VARCHAR, e.g., 'GRADING', 'COMPLETED')
created_at (TIMESTAMP WITH TIME ZONE)
shenlun_feedback (申论批改反馈表)

id (UUID, PK)
submission_id (UUID, FK to shenlun_submissions.id, UNIQUE)
structure_feedback (TEXT)
content_feedback (TEXT)
language_feedback (TEXT)
overall_comment (TEXT)
ai_score (INTEGER)
6. 核心 AI 模块设计 (MVP)
6.1 智能诊断与推荐服务
输入: 用户诊断测试的答题记录（题目ID、答案、耗时）。
核心算法:
能力评估: 基于知识点图谱和答题正确率，计算用户在各个模块和知识点上的初步掌握度分数。
弱点识别: 找出掌握度分数最低的 3-5 个知识点作为核心弱点。
学习计划生成: 采用基于规则的策略，为用户生成一个为期 N 周的学习计划。计划会优先安排弱点知识点的专项练习，并穿插已掌握知识点的复习。
输出:
一份包含各模块能力分数的诊断报告 (JSON)。
一个结构化的学习任务列表 (JSON)。
6.2 申论批改服务 (MVP)
输入: 申论材料文本、用户提交的文章文本。
核心算法 (聚焦于客观、可量化的指标):
文本预处理: 清洗文本，分句，分词。
要点匹配:
使用 TF-IDF 或 ** Sentence-BERT (语义相似度)** 算法，从材料中提取核心关键词/关键句。
计算用户文章对这些核心要点的覆盖率。
结构分析:
使用正则表达式或简单规则，分析文章的段落数量、总分总结构（如开头结尾段与中间段的相似度）。
基础检查:
统计总字数，检查是否在要求范围内。
使用成熟的 语言模型 或 规则库 进行基础的错别字和语法错误检测。
输出:
结构化的批改反馈 (JSON)，包含要点覆盖率、结构评价、字数统计和基础语言错误列表。