# ç”³è®ºå››å¤§é¢˜å‹æ ¸å¿ƒç§˜ç± - å®Œæ•´ç‰ˆæœ¬
ESSAY_GRADING_MANUAL = """ã€Šç”³è®ºå››å¤§é¢˜å‹æ ¸å¿ƒç§˜ç±ã€‹
ç¼–åˆ¶äººï¼šæ‚¨çš„ç”³è®ºå­¦ä¹ ä¸åˆ†æåŠ©ç†ï¼Œæ‚Ÿé“

å‰è¨€

è€å¸ˆï¼Œæ‚¨å¥½ã€‚

ç»è¿‡å¯¹æ‚¨æä¾›çš„ä¸€ç³»åˆ—é«˜åˆ†ä½œç­”èŒƒä¾‹çš„ç³»ç»Ÿå­¦ä¹ ï¼Œæˆ‘å·²å°†å…¶ä¸­è•´å«çš„è§£é¢˜æ™ºæ…§ï¼Œä¸ºæ‚¨æ„å»ºæˆæ­¤ä»½ç§˜ç±ã€‚æœ¬ç§˜ç±æ¶µç›–æ¦‚æ‹¬é¢˜ã€ç»¼åˆåˆ†æé¢˜ã€å¯¹ç­–é¢˜ã€åº”ç”¨æ–‡å†™ä½œé¢˜å››å¤§æ ¸å¿ƒé¢˜å‹ï¼Œæ¯ä¸€ç« èŠ‚éƒ½è‡´åŠ›äºæ­ç¤ºè¯¥é¢˜å‹çš„åº•å±‚é€»è¾‘ï¼Œå¹¶æä¾›ä¸€å¥—"å››æ­¥æ³•"æ ¸å¿ƒæ–¹æ³•è®ºï¼Œè¾…ä»¥æˆ‘ä»¬å…±åŒå­¦ä¹ è¿‡çš„ç»å…¸æ¡ˆä¾‹ï¼Œä»¥æ±‚ç†è®ºä¸å®è·µçš„å®Œç¾ç»“åˆã€‚

æ„¿è¿™ä»½ç§˜ç±èƒ½æˆä¸ºæ‚¨åœ¨ç”³è®ºå­¦ä¹ é“è·¯ä¸Šçš„ä¸€ç›æ˜ç¯ï¼ŒåŠ©æ‚¨æ´æ‚‰è§„å¾‹ï¼Œè¿ç¬”å¦‚ç¥ã€‚

ç¬¬ä¸€ç« ï¼šæ¦‚æ‹¬é¢˜â€”â€”ä¿¡æ¯é™ç»´ä¸é€»è¾‘é‡å»ºçš„è‰ºæœ¯
ã€æ ¸å¿ƒæ€æƒ³ã€‘
æ¦‚æ‹¬é¢˜çš„æœ¬è´¨ï¼Œæ˜¯å°†çº·ç¹å¤æ‚çš„åŸå§‹ææ–™è¿›è¡Œ"ä¿¡æ¯é™ç»´"ï¼Œå¹¶é€šè¿‡"é€»è¾‘é‡å»º"ï¼Œæœ€ç»ˆå‘ˆç°ä¸ºä¸€ä»½è¦ç‚¹å…¨é¢ã€é€»è¾‘æ¸…æ™°ã€è¯­è¨€ç²¾ç‚¼çš„ç­”æ¡ˆã€‚å®ƒè€ƒéªŒçš„æ˜¯ç²¾å‡†çš„æœå¯»èƒ½åŠ›ä¸é«˜æ•ˆçš„æ•´åˆèƒ½åŠ›ã€‚

ã€å››æ­¥æ ¸å¿ƒæ–¹æ³•è®ºã€‘

ç¬¬ä¸€æ­¥ï¼šå®¡é¢˜å®šæ ‡â€”â€”æ˜ç¡®"æ¦‚æ‹¬è°"ã€"åœ¨å“ªæ‰¾"ã€"æ€ä¹ˆç­”"
è¿™æ˜¯è§£é¢˜çš„"å¯¼èˆª"é˜¶æ®µï¼Œç¡®ä¿æ–¹å‘æ— è¯¯ã€‚

å®šå¯¹è±¡ï¼šæ˜ç¡®æ¦‚æ‹¬çš„æ ¸å¿ƒæ˜¯"åšæ³•"ã€"åŸå› "ã€"å˜åŒ–"è¿˜æ˜¯"é—®é¢˜"ã€‚è¿™å†³å®šäº†æ‚¨å¯»æ‰¾ä¿¡æ¯çš„ç„¦ç‚¹ã€‚
ã€ä¾‹ã€‘ ç¬¬1é¢˜è¦æ±‚æ¦‚æ‹¬å°æ¢çš„"åšæ³•"ï¼ˆåšäº†ä»€ä¹ˆï¼‰ï¼Œè€Œç¬¬4é¢˜è¦æ±‚æ¦‚æ‹¬å°ç«¥çš„"åŸå› "ï¼ˆä¸ºä½•ä¼˜ç§€ï¼‰ã€‚å‰è€…è¦é‡ç‚¹å¯»æ‰¾åŠ¨è¯æ€§è¯ç»„ï¼Œåè€…åˆ™éœ€å…³æ³¨è¯„ä»·æ€§ã€å› æœæ€§çš„è¡¨è¿°ã€‚
å®šèŒƒå›´ï¼šé”å®šç­”æ¡ˆæ¥æºçš„æŒ‡å®šææ–™ï¼Œç­”æ¡ˆå¿…é¡»å®Œå…¨åŸºäºç»™å®šèŒƒå›´ï¼Œæœç»ä»»ä½•å½¢å¼çš„è‡ªæˆ‘å‘æŒ¥ã€‚
å®šè¦æ±‚ï¼šä¸¥æ ¼éµå®ˆå­—æ•°é™åˆ¶ï¼Œå¹¶æ ¹æ®"æ¡ç†æ¸…æ™°"ç­‰è¦æ±‚ï¼Œé¢„åˆ¤ç­”æ¡ˆéœ€é‡‡ç”¨åˆ†ç‚¹å½¢å¼ã€‚
ç¬¬äºŒæ­¥ï¼šç²¾å‡†æ‰¾ç‚¹â€”â€”éµå¾ªææ–™ï¼Œåœ°æ¯¯å¼æœå¯»å…³é”®ä¿¡æ¯
è¿™æ˜¯è§£é¢˜çš„"é‡‡çŸ¿"é˜¶æ®µï¼ŒåŠ¡æ±‚å…¨é¢æ— é—æ¼ã€‚

å…³é”®è¯å®šä½æ³•ï¼šå¯»æ‰¾ä¸æ¦‚æ‹¬å¯¹è±¡ç›´æ¥ç›¸å…³çš„è¯å¥ã€‚
ã€ä¾‹ã€‘ æ¦‚æ‹¬ç¬¬1é¢˜å°æ¢çš„"åšæ³•"æ—¶ï¼Œå¯è¿…é€Ÿå®šä½ææ–™ä¸­çš„"å¾é›†...å¾®å¿ƒæ„¿"ã€"è®¾è®¡...è¯„åˆ†ç»†åˆ™"ã€"åˆ¶æˆç²¾ç¾æµ·æŠ¥"ã€"å®è¡Œæœ‰å¥–ä¸¾æŠ¥åˆ¶åº¦"ç­‰ä¸€ç³»åˆ—åŠ¨å®¾çŸ­è¯­ã€‚
å¤šä¸»ä½“è§†è§’æ³•ï¼šå½“ææ–™æ¶‰åŠä¸åŒäººç‰©æˆ–ç¾¤ä½“çš„è§‚ç‚¹æ—¶ï¼Œåº”åˆ†åˆ«æå–ï¼Œä»¥ç¡®ä¿å…¨é¢æ€§ã€‚
ã€ä¾‹ã€‘ åœ¨ç¬¬4é¢˜æ¦‚æ‹¬å°ç«¥å—å¥½è¯„çš„åŸå› æ—¶ï¼Œé«˜åˆ†ç­”æ¡ˆæ­£æ˜¯ä»"é¢†å¯¼è¯´"ã€"åŒäº‹ä»¬è¯´"ã€"è€ä¹¡ä»¬è¯´"å’Œä»–"è‡ªå·±è¯´"å››ä¸ªä¸åŒä¸»ä½“è§†è§’å‡ºå‘ï¼Œå®Œæ•´åœ°æ„å»ºäº†ç­”æ¡ˆã€‚
ç¬¬ä¸‰æ­¥ï¼šé€»è¾‘å½’å¹¶â€”â€”åˆ†ç±»åˆå¹¶ï¼Œæç‚¼å‡åæ ¸å¿ƒè¦ç‚¹
è¿™æ˜¯è§£é¢˜çš„"å†¶ç‚¼"é˜¶æ®µï¼Œå°†åŸå§‹çŸ¿çŸ³æç‚¼ä¸ºé«˜çº¯åº¦é‡‘å±ã€‚

é€»è¾‘å½’ç±»ï¼šæŒ‰ç‰¹å®šç»´åº¦ï¼ˆå¦‚é¢†åŸŸã€ä¸»ä½“ã€æ—¶é—´ã€æ€§è´¨ç­‰ï¼‰å¯¹é›¶æ•£è¦ç‚¹è¿›è¡Œé‡ç»„ï¼Œæ˜¯å®ç°"æ¡ç†æ¸…æ™°"çš„å…³é”®ã€‚
ã€ä¾‹ã€‘ ç¬¬6é¢˜æ¦‚æ‹¬"å®¶ä¹¡çš„æ–°å˜åŒ–"ï¼Œææ–™ä¸­æœ‰ç½‘è´­ã€ç”µå•†å›­ã€ä¿®è·¯ã€ç¯å¢ƒç¾ã€è¿”ä¹¡äººå¤šç­‰é›¶æ•£ä¿¡æ¯ã€‚é«˜åˆ†ç­”æ¡ˆå°†å…¶é‡æ„ä¸º"ç”Ÿæ´»æ›´å¯Œè£•ã€äº§ä¸šæ›´å…´æ—ºã€ä¹¡æ‘æ›´å®œå±…ã€å¸å¼•åŠ›æ›´å¤§"å››ä¸ªé€»è¾‘å±‚é¢ï¼Œä½¿ç­”æ¡ˆå±‚æ¬¡ç¬é—´æå‡ã€‚
è¯­è¨€ç²¾ç‚¼ï¼šå°†ææ–™ä¸­çš„å£è¯­ã€æ¡ˆä¾‹ã€æè¿°æ€§è¯­è¨€ï¼Œè½¬åŒ–ä¸ºè§„èŒƒã€ç®€æ´ã€é«˜åº¦æ¦‚æ‹¬çš„ç”³è®ºä¹¦é¢è¯­ã€‚
ã€ä¾‹ã€‘ å°†"å¤§å®¶è…°åŒ…é‡Œæœ‰äº†é’±ï¼Œå¿ƒæ°”è¶³äº†"æç‚¼ä¸º"æ‘æ°‘ç”Ÿæ´»æ°´å¹³æé«˜"ã€‚
ç¬¬å››æ­¥ï¼šè§„èŒƒæˆæ–‡â€”â€”æ€»åˆ†æœ‰åºï¼Œæ¸…æ™°å‘ˆç°
è¿™æ˜¯è§£é¢˜çš„"æˆå‹"é˜¶æ®µï¼Œå°†æˆæœä»¥æœ€åˆ©äºå¾—åˆ†çš„å½¢å¼å±•ç°å‡ºæ¥ã€‚

"æ€»-åˆ†"ç»“æ„ï¼šå…ˆç”¨ä¸€å¥è¯æ€»é¢†å…¨æ–‡ï¼Œç„¶ååˆ†æ¡åˆ—ç‚¹é˜è¿°ã€‚
ã€ä¾‹ã€‘ ç¬¬2é¢˜ç­”æ¡ˆå¼€å¤´çš„"è€é©¬æŠŠä¸ºç¾¤ä¼—æœåŠ¡è§†ä¸ºç»ˆç”Ÿäº‹ä¸šï¼Œå½“å¥½åŸºå±‚ç»£èŠ±é’ˆã€‚"å³æ˜¯å®Œç¾çš„æ€»èµ·å¥ã€‚
è¦ç‚¹åŒ–å‘ˆç°ï¼šæ¸…æ™°åœ°ä½¿ç”¨"ä¸€ã€äºŒã€ä¸‰ã€"æˆ–"1.2.3."ç­‰åºå·ï¼Œè®©è¦ç‚¹ä¸€ç›®äº†ç„¶ï¼Œæ–¹ä¾¿é˜…å·è€å¸ˆå¿«é€Ÿæ•æ‰å¾—åˆ†ç‚¹ã€‚
ã€æœ¬ç« å°ç»“ã€‘
æ¦‚æ‹¬é¢˜çš„ç²¾é«“åœ¨äºï¼šä»"æ‰¾å¾—åˆ°"åˆ°"å¹¶å¾—å¥½"ï¼Œå†åˆ°"è¯´å¾—æ¸…"ã€‚

ç¬¬äºŒç« ï¼šç»¼åˆåˆ†æé¢˜â€”â€”è§£æ„ä¸é‡æ„çš„é€»è¾‘æ€è¾¨
ã€æ ¸å¿ƒæ€æƒ³ã€‘
ç»¼åˆåˆ†æé¢˜çš„æœ¬è´¨ï¼Œæ˜¯"è§£æ„ä¸é‡æ„"ã€‚å®ƒè¦æ±‚æˆ‘ä»¬æ·±å…¥ææ–™ï¼Œæ‹†è§£ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µæˆ–ç°è±¡çš„å†…åœ¨é€»è¾‘ï¼Œç„¶åç”¨ææ–™ä¸­çš„ä¿¡æ¯ä½œä¸ºè®ºæ®ï¼Œé‡æ„å‡ºä¸€ä¸ªé€»è¾‘ä¸¥å¯†ã€å±‚æ¬¡åˆ†æ˜çš„åˆ†ææ€§ç­”æ¡ˆã€‚å®ƒè€ƒéªŒçš„æ˜¯é€è¿‡ç°è±¡çœ‹æœ¬è´¨çš„æ€è¾¨èƒ½åŠ›ã€‚

ã€å››æ­¥æ ¸å¿ƒæ–¹æ³•è®ºã€‘

ç¬¬ä¸€æ­¥ï¼šå®¡é¢˜æ‹†è§£â€”â€”è¯†åˆ«åˆ†æç±»å‹ï¼Œé”å®šæ ¸å¿ƒå¯¹è±¡
è¿™æ˜¯åˆ†æçš„èµ·ç‚¹ï¼Œç¡®å®šæˆ‘ä»¬è¦"è§£å‰–"çš„æ˜¯ä»€ä¹ˆã€‚

å®šç±»å‹ï¼šåˆ¤æ–­åˆ†æçš„æ ¸å¿ƒä»»åŠ¡æ˜¯"é˜é‡Šå«ä¹‰"ã€"åˆ†æåŸå› "ã€"è¯„ä»·åˆ†æ"è¿˜æ˜¯"åˆ†æå˜åŒ–"ã€‚
ã€ä¾‹ã€‘ ç¬¬1é¢˜"è°ˆè°ˆå¯¹'ç§æˆ'çš„ç†è§£"æ˜¯é˜é‡Šå«ä¹‰å‹ï¼›ç¬¬5é¢˜"åˆ†æä»–ä¸ºä»€ä¹ˆæ„Ÿåˆ°å‹åŠ›å¾ˆå¤§"åˆ™æ˜¯åˆ†æåŸå› å‹ã€‚å‰è€…é‡åœ¨è§£é‡Šæ„æˆï¼Œåè€…é‡åœ¨æ¢ç©¶æ ¹æºã€‚
å®šå¯¹è±¡ï¼šåœˆå®šé¢˜å¹²ä¸­éœ€è¦è¢«åˆ†æçš„å…³é”®è¯ã€åˆ’çº¿å¥å­æˆ–æ ¸å¿ƒç°è±¡ï¼Œæ‰€æœ‰åˆ†æå¿…é¡»å›´ç»•å®ƒå±•å¼€ã€‚
ç¬¬äºŒæ­¥ï¼šæœå¯»ç»„ä»¶â€”â€”å¸¦ç€é—®é¢˜é˜…è¯»ï¼Œå¯»æ‰¾é€»è¾‘å…³ç³»
è¿™æ˜¯ä¸º"é‡æ„"å‡†å¤‡ç´ æï¼Œå¯»æ‰¾èƒ½å¤Ÿæ­å»ºé€»è¾‘é“¾æ¡çš„"ç –å—"ã€‚

æŒ–æ˜é€»è¾‘å…ƒç´ ï¼šè¶…è¶Šå¯»æ‰¾è¡¨é¢"è¦ç‚¹"ï¼Œæ·±å…¥æŒ–æ˜ææ–™ä¸­éšè—çš„é€»è¾‘å…ƒç´ ï¼š
å®šä¹‰ä¸è¡¨ç° (What / How)
åŸå› ä¸ç›®çš„ (Why)
å½±å“ä¸æ„ä¹‰ (Significance)
ã€ä¾‹ã€‘ åœ¨åˆ†æç¬¬1é¢˜"ç§æˆ"æ—¶ï¼Œé«˜åˆ†ç­”æ¡ˆæ­£æ˜¯æ‰¾åˆ°äº†å…¶åšæ³•ï¼ˆHowï¼‰ã€ç›®çš„ï¼ˆWhyï¼‰å’Œç›®æ ‡ï¼ˆSignificanceï¼‰ç­‰å¤šç§é€»è¾‘ç»„ä»¶ï¼Œæ‰æ„æˆäº†ä¸°æ»¡çš„é˜é‡Šã€‚
ç¬¬ä¸‰æ­¥ï¼šé€»è¾‘é‡æ„â€”â€”æ­å»ºåˆ†ææ¡†æ¶ï¼Œä¸²è”è®ºè¯é“¾æ¡
è¿™æ˜¯ç»¼åˆåˆ†æé¢˜çš„çµé­‚ï¼Œå±•ç°åˆ†æçš„æ·±åº¦ä¸å¹¿åº¦ã€‚

æ­å»ºåˆ†ææ¡†æ¶ï¼šå°†å¤æ‚æ¦‚å¿µä»ä¸åŒç»´åº¦è¿›è¡Œæ‹†è§£ï¼Œæ˜¯ç­”æ¡ˆå‡ºå½©çš„å…³é”®ã€‚
ã€ä¾‹ã€‘ åœ¨åˆ†æç¬¬2é¢˜å°å´çš„"å˜åŒ–"æ—¶ï¼Œé«˜åˆ†ç­”æ¡ˆæ­å»ºäº†"è‡ªæˆ‘è®¤çŸ¥ã€å·¥ä½œç›®æ ‡ã€å·¥ä½œæ–¹å¼ã€å·¥ä½œèƒ½åŠ›"å››ä¸ªç»´åº¦ï¼Œå¯¹"å˜åŒ–"è¿›è¡Œäº†ç«‹ä½“åŒ–çš„è§£æ„ï¼Œæå¯Œæ·±åº¦ã€‚
æ„å»ºé€»è¾‘é“¾ï¼šå°†æœå¯»åˆ°çš„ç»„ä»¶æœ‰æœºç»„ç»‡ï¼Œæ­ç¤ºå†…åœ¨å…³ç³»ã€‚
ã€ä¾‹ã€‘ åœ¨åˆ†æç¬¬8é¢˜"æ”¿ç­–ä¸Šçš„å–„æ„"æ—¶ï¼Œç­”æ¡ˆæ¸…æ™°åœ°æ„å»ºäº†ä¸€æ¡é€»è¾‘é“¾ï¼šæ”¿ç­–åˆè¡·ï¼ˆå–„æ„ï¼‰â†’ æ‰§è¡Œé‡é˜»ï¼ˆåšå¼ˆï¼‰â†’ è°ƒæ•´æ–¹å¼ï¼ˆæŠ€æœ¯è¿­ä»£ï¼‰â†’ å–„æ„è½åœ°ï¼ˆæ‰“æ¶ˆç–‘è™‘ï¼‰ï¼Œé€»è¾‘ä¸¥å¯†ï¼Œè¯´æœåŠ›å¼ºã€‚
ç¬¬å››æ­¥ï¼šè§„èŒƒä½œç­”â€”â€”è§‚ç‚¹å‰ç½®ï¼Œè®ºè¿°æ¸…æ™°
è¿™æ˜¯åˆ†æçš„æœ€ç»ˆå‘ˆç°ï¼Œè®©æ€è€ƒè¿‡ç¨‹æ¸…æ™°å¯è§ã€‚

è§‚ç‚¹å‰ç½®ï¼šåœ¨ç­”æ¡ˆå¼€å¤´å°±äº®æ˜æ ¸å¿ƒè§‚ç‚¹ï¼Œå¼€é—¨è§å±±ã€‚
ã€ä¾‹ã€‘ ç¬¬3é¢˜ç­”æ¡ˆç¬¬ä¸€å¥ï¼š"è¿™å¥è¯æŒ‡åŸå¸‚æ°´ç³»ä½“ç°äº†åŸå¸‚çš„ç‰¹è‰²ã€‚"ç›´æ¥ç‚¹ç ´æ¯”å–»çš„æœ¬è´¨ï¼Œä¸ºä¸‹æ–‡çš„åˆ†æç¡®ç«‹äº†æ€»çº²ã€‚
è¯­è¨€åˆ†æåŒ–ï¼šå°†ææ–™ä¸­çš„äº‹å®å’Œæ¡ˆä¾‹ï¼Œè½¬åŒ–ä¸ºæ”¯æ’‘åˆ†æçš„è®ºæ®ï¼Œå®Œæˆä»"è®²æ•…äº‹"åˆ°"åšåˆ†æ"çš„è½¬å˜ã€‚
ã€ä¾‹ã€‘ å°†ææ–™ä¸­å°å´"æŠŠé‹é™·è¿›äº†æ³¥é‡Œ"çš„æè¿°ï¼Œæç‚¼ä¸º"ä»é«˜çœ‹è‡ªå·±åˆ°ä¸æ‘æ°‘åŒåŠ³ä½œï¼Œç†è§£æ‘æ°‘ä¸æ˜“"ã€‚
ã€æœ¬ç« å°ç»“ã€‘
ç»¼åˆåˆ†æé¢˜çš„ç²¾é«“åœ¨äºï¼šé€è¿‡ç°è±¡çœ‹æœ¬è´¨ï¼Œç†æ¸…é€»è¾‘æ˜¯å…³é”®ã€‚

ç¬¬ä¸‰ç« ï¼šå¯¹ç­–é¢˜â€”â€”å¯¹ç—‡ä¸‹è¯çš„ç²¾å‡†æ–½ç­–
ã€æ ¸å¿ƒæ€æƒ³ã€‘
å¯¹ç­–é¢˜çš„æœ¬è´¨æ˜¯"å¯¹ç—‡ä¸‹è¯"ã€‚å®ƒè¦æ±‚æˆ‘ä»¬åŸºäºææ–™æ­ç¤ºçš„é—®é¢˜ï¼Œä»¥ç‰¹å®šèº«ä»½æå‡ºæœ‰é’ˆå¯¹æ€§ã€å…·å¤‡å¯è¡Œæ€§ã€ç¬¦åˆé€»è¾‘çš„è§£å†³æ–¹æ¡ˆã€‚å®ƒè€ƒéªŒçš„æ˜¯ä»"åˆ†æé—®é¢˜"åˆ°"è§£å†³é—®é¢˜"çš„è½¬åŒ–èƒ½åŠ›ã€‚

ã€å››æ­¥æ ¸å¿ƒæ–¹æ³•è®ºã€‘

ç¬¬ä¸€æ­¥ï¼šç²¾å‡†é—®é¢˜è¯Šæ–­â€”â€”æ‰¾åˆ°"ç—…æ ¹"ï¼Œæ‰èƒ½å¼€"è¯æ–¹"
æ‰€æœ‰æœ‰æ•ˆçš„å¯¹ç­–ï¼Œéƒ½æºäºå¯¹é—®é¢˜çš„æ·±åˆ»ç†è§£ã€‚

æ˜ç¡®é—®é¢˜ã€æ·±æŒ–åŸå› ï¼šä¸ä»…è¦çœ‹åˆ°è¡¨é¢é—®é¢˜ï¼Œæ›´è¦åˆ†æå¯¼è‡´é—®é¢˜äº§ç”Ÿçš„æ·±å±‚æ¬¡åŸå› ã€‚
ã€ä¾‹ã€‘ åœ¨ç¬¬2é¢˜"è€å­—å·å‘å±•å›°å¢ƒ"ä¸­ï¼Œä¸ä»…æœ‰"ç»è¥ç©ºé—´èç¼©"ç­‰è¡¨é¢é—®é¢˜ï¼Œæ›´æœ‰"ç»è¥æ–¹å¼è½åã€å†å²åŒ…è¢±é‡"ç­‰æ·±å±‚"ç—…æ ¹"ã€‚å¯¹ç­–å¿…é¡»é’ˆå¯¹è¿™äº›ç—…æ ¹æ¥æå‡ºã€‚
ç¬¬äºŒæ­¥ï¼šè§’è‰²å®šä½ä¸è§†è§’é”å®šâ€”â€”"è°æ¥è§£å†³"ï¼Œå†³å®š"èƒ½æ€ä¹ˆè§£å†³"
é¢˜å¹²é€šå¸¸ä¼šè®¾å®šè§’è‰²ï¼Œè¿™ä¸ªè§’è‰²å†³å®šäº†å¯¹ç­–çš„æƒè´£èŒƒå›´ã€‚

æ˜ç¡®èº«ä»½ã€é”å®šè§†è§’ï¼šæˆ‘æ˜¯è°ï¼Ÿæˆ‘èƒ½åšä»€ä¹ˆï¼Ÿ
ã€ä¾‹ã€‘ ç¬¬2é¢˜è¦æ±‚"ä»æ”¿åºœè§’åº¦"ææªæ–½ã€‚å› æ­¤ï¼Œç­”æ¡ˆæå‡ºçš„"åŠ å¼ºä¿æŠ¤ã€ç§¯ææ‰¶æŒã€æ”¯æŒèèµ„"ç­‰éƒ½æ˜¯æ”¿åºœèŒèƒ½èŒƒå›´å†…çš„è¡Œä¸ºã€‚å¦‚æœæå‡ºä¼ä¸šå†…éƒ¨ç®¡ç†å»ºè®®ï¼Œåˆ™å±äºè§†è§’é”™è¯¯ã€‚
ç¬¬ä¸‰æ­¥ï¼šä»ææ–™ä¸­å¯»æ‰¾å¯¹ç­–æ¥æºâ€”â€”å¯¹ç­–æ˜¯"æ‰¾"ä¸"åˆ›"çš„ç»“åˆ
ç”³è®ºå¯¹ç­–çš„ç­”æ¡ˆè¦ç‚¹ç»å¤§éƒ¨åˆ†æ¥æºäºç»™å®šèµ„æ–™ã€‚

ç›´æ¥æç‚¼ï¼šææ–™ä¸­æ˜ç¡®ç»™å‡ºäº†æˆåŠŸçš„åšæ³•æˆ–ç°æˆçš„å»ºè®®ã€‚
ã€ä¾‹ã€‘ ç¬¬1é¢˜"åŠ å¼ºç”µå•†è¯šä¿¡ä½“ç³»å»ºè®¾"ä¸­ï¼Œææ–™ç›´æ¥æåˆ°äº†"æˆç«‹è¯šä¿¡è”ç›Ÿ"ã€"æ¨å‡ºä¼ä¸šè¯šä¿¡æŸ¥è¯¢å¹³å°"ç­‰ï¼Œå¯ç›´æ¥é‡‡çº³ã€‚
é—®é¢˜åæ¨ï¼šå°†ææ–™ä¸­åæ˜ çš„é—®é¢˜åå‘è½¬åŒ–ä¸ºå¯¹ç­–ï¼Œè¿™æ˜¯æœ€æ ¸å¿ƒçš„æ–¹æ³•ã€‚
ã€ä¾‹ã€‘ ç¬¬2é¢˜ä¸­ï¼Œè€å­—å·çš„é—®é¢˜æ˜¯"äº§å“æ›´æ–°æ…¢"ï¼Œåæ¨çš„å¯¹ç­–å°±æ˜¯"æ¨åŠ¨è½¬å‹å‡çº§ï¼Œå¼€å±•æŠ€æœ¯ç ”å‘ä¸åˆ›æ–°"ã€‚
ç»éªŒå€Ÿé‰´ï¼šå€Ÿé‰´ææ–™ä¸­å…¶ä»–åœ°åŒºæˆ–é¢†åŸŸçš„æˆåŠŸç»éªŒã€‚
ã€ä¾‹ã€‘ ç¬¬6é¢˜è¦æ±‚ä»æ²ˆä¹¦è®°çš„"ä¸‰æ€•"ä¸­å¾—åˆ°å¯ç¤ºã€‚"æ€•å¬ä¸åˆ°éª‚å£°"å¯ç¤ºæ‰§æ³•å·¥ä½œè¦"å¯†åˆ‡è”ç³»ç¾¤ä¼—ï¼Œå¤šå¬ç¾¤ä¼—å¿ƒå£°"ã€‚
ç¬¬å››æ­¥ï¼šç»“æ„åŒ–ä¸"åŠ¨è¯åŒ–"å‘ˆç°â€”â€”è®©å¯¹ç­–æ¸…æ™°æœ‰åŠ›ï¼Œå…·å¤‡å¯æ“ä½œæ€§
å¥½çš„å¯¹ç­–ï¼Œå½¢å¼ä¸Šä¹Ÿè¦æ¸…æ™°ã€æœ‰åŠ›ã€‚

é€»è¾‘å½’ç±»ï¼šå°†å¯¹ç­–æŒ‰ä¸»ä½“ï¼ˆæ”¿åºœã€ä¼ä¸šï¼‰ã€å±‚é¢ï¼ˆæ€æƒ³ã€åˆ¶åº¦ï¼‰ç­‰ç»´åº¦åˆ†ç±»ã€‚
"åŠ¨è¯+å®¾è¯­+å…·ä½“é˜è¿°"å¥å¼ï¼šè®©å¯¹ç­–å¬èµ·æ¥åƒä¸€ä¸ªå¯æ‰§è¡Œçš„è¡ŒåŠ¨æŒ‡ä»¤ã€‚
ã€ä¾‹ã€‘ ç¬¬3é¢˜"ä¼ æ‰¿å¥½å¤§è¿æ²³æ–‡åŒ–"çš„ç­”æ¡ˆï¼Œæ¯ä¸€æ¡éƒ½æ˜¯å¼ºæœ‰åŠ›çš„åŠ¨å®¾ç»“æ„ï¼š"ç²¾å¿ƒä¿æŠ¤å¤§è¿æ²³é—äº§"ã€"æœ‰æ•ˆä¼ æ‰¿å¤§è¿æ²³æ–‡åŒ–"ã€"åˆç†åˆ©ç”¨å¤§è¿æ²³èµ„æº"ï¼Œå¹¶è¾…ä»¥å…·ä½“åšæ³•ï¼Œå¯æ“ä½œæ€§æå¼ºã€‚
ã€æœ¬ç« å°ç»“ã€‘
å¯¹ç­–é¢˜çš„ç²¾é«“åœ¨äºï¼šç«‹è¶³é—®é¢˜ï¼Œç«™å¯¹è§’è‰²ï¼Œå¯¹ç­–æ‰æœ‰ç”Ÿå‘½åŠ›ã€‚

ç¬¬å››ç« ï¼šåº”ç”¨æ–‡å†™ä½œé¢˜â€”â€”å¸¦ç€é•£é“çš„åœºæ™¯ä¹‹èˆ
ã€æ ¸å¿ƒæ€æƒ³ã€‘
åº”ç”¨æ–‡å†™ä½œæ˜¯"å¸¦ç€é•£é“è·³èˆ"ã€‚å®ƒæ˜¯åœ¨ç‰¹å®šæƒ…å¢ƒä¸‹ï¼Œä¸ºè¾¾åˆ°ç‰¹å®šç›®çš„ï¼Œé¢å‘ç‰¹å®šå¯¹è±¡ï¼Œä½¿ç”¨ç‰¹å®šæ ¼å¼è¿›è¡Œçš„ä¸€æ¬¡ä¹¦é¢æ²Ÿé€šã€‚å®ƒè€ƒéªŒçš„æ˜¯åœºæ™¯è¿˜åŸå’Œè§’è‰²æ‰®æ¼”çš„ç»¼åˆèƒ½åŠ›ã€‚

ã€å››æ­¥æ ¸å¿ƒæ–¹æ³•è®ºã€‘

ç¬¬ä¸€æ­¥ï¼šæƒ…å¢ƒè§£æ„ï¼ˆé»„é‡‘ä¸‰é—®ï¼‰â€”â€”æˆ‘æ˜¯è°ï¼Ÿå†™ç»™è°ï¼Ÿä¸ºä»€ä¹ˆå†™ï¼Ÿ
è¿™æ˜¯åº”ç”¨æ–‡å†™ä½œçš„çµé­‚ï¼Œå†³å®šäº†æ–‡ç« çš„åŸºè°ƒã€å†…å®¹å’Œç»“æ„ã€‚

æ˜ç¡®èº«ä»½ï¼ˆæˆ‘æ˜¯è°ï¼Ÿï¼‰
æ˜ç¡®å¯¹è±¡ï¼ˆå†™ç»™è°ï¼Ÿï¼‰
æ˜ç¡®ç›®çš„ï¼ˆä¸ºä»€ä¹ˆå†™ï¼Ÿï¼‰
ã€ä¾‹ã€‘ åœ¨ç¬¬9é¢˜"å…¬å¼€ä¿¡"ä¸­ï¼Œæˆ‘æ˜¯åŒºåŸç®¡å±€ï¼Œå†™ç»™æœ‰è´¨ç–‘çš„å±…æ°‘ï¼Œç›®çš„æ˜¯è§£é‡Šæš‚åœä¿®è·¯çš„åŸå› å¹¶å®‰æŠšæƒ…ç»ªã€‚è¿™ä¸ªæƒ…å¢ƒç«‹åˆ»å†³å®šäº†ä¿¡ä»¶çš„åŸºè°ƒå¿…é¡»è¯šæ³ã€è´Ÿè´£ï¼Œå†…å®¹å¿…é¡»åŒ…å«å…±æƒ…ã€è§£é‡Šå’Œæ‰¿è¯ºã€‚
ç¬¬äºŒæ­¥ï¼šæ ¼å¼éµä»â€”â€”"ç©¿å¯¹è¡£æœ"ï¼Œæ‰èƒ½"ç™»å¯¹åœºåˆ"
æ ¼å¼æ˜¯åº”ç”¨æ–‡çš„"å¤–è¡£"ï¼Œæ˜¯å¾—åˆ†çš„åˆšæ€§è¦æ±‚ã€‚

æŒæ¡åŸºæœ¬æ ¼å¼ï¼šæ ‡é¢˜ã€ç§°è°“ã€æ­£æ–‡ã€è½æ¬¾ã€‚
çµæ´»åº”ç”¨ï¼šä¸åŒæ–‡ç§æ ¼å¼æœ‰åˆ«ã€‚
ã€ä¾‹ã€‘ å€¡è®®ä¹¦ï¼ˆç¬¬1ã€7é¢˜ï¼‰å’Œå…¬å¼€ä¿¡ï¼ˆç¬¬9é¢˜ï¼‰é€šå¸¸éœ€è¦å®Œæ•´çš„å››è¦ç´ ã€‚è€Œå‘è¨€æçº²ï¼ˆç¬¬2é¢˜ï¼‰åˆ™é‡åœ¨è¦ç‚¹åŒ–ã€åºå·åŒ–ï¼Œé€»è¾‘å±‚æ¬¡æ¸…æ™°å³å¯ã€‚
ç¬¬ä¸‰æ­¥ï¼šå†…å®¹ç»„ç»‡ä¸é€»è¾‘æ„å»ºâ€”â€”è¨€ä¹‹æœ‰ç‰©ï¼Œæ¡ç†æ¸…æ™°
è¿™æ˜¯åº”ç”¨æ–‡çš„"è¡€è‚‰"ï¼Œéœ€è¦ä»ææ–™ä¸­æå–æ ¸å¿ƒä¿¡æ¯ï¼Œå¹¶æŒ‰ç…§æ–‡ç§çš„å†…åœ¨é€»è¾‘è¿›è¡Œç»„ç»‡ã€‚

æ„å»ºé€»è¾‘æ¡†æ¶ï¼š
å€¡è®®ä¹¦/å…¬å¼€ä¿¡ï¼šå¸¸é‡‡ç”¨"èƒŒæ™¯/é—®é¢˜ â†’ æ ¸å¿ƒå†…å®¹/å»ºè®® â†’ å‘å‡ºå·å¬/æ€»ç»“"çš„ä¸‰æ®µå¼ç»“æ„ã€‚
å‘è¨€ç¨¿/ä»‹ç»ç¨¿ï¼šå¸¸æŒ‰"èƒŒæ™¯ â†’ åšæ³• â†’ æˆæ•ˆ â†’ å±•æœ›"çš„é€»è¾‘å±•å¼€ã€‚
ã€ä¾‹ã€‘ ç¬¬2é¢˜å°èµµçš„å‘è¨€æçº²ï¼Œå°±å®Œç¾éµå¾ªäº†"å‘ç°é—®é¢˜ â†’ å¯»æ‰¾æ–¹æ¡ˆ â†’ å®æ–½æ–¹æ¡ˆ â†’ æ‹“å±•æˆæœ"çš„å™äº‹é€»è¾‘ï¼Œéå¸¸æœ‰æ¡ç†ã€‚
ç¬¬å››æ­¥ï¼šè¯­è¨€é£æ ¼ä¸è¯­æ°”åŒ¹é…â€”â€”"è¯´ä»€ä¹ˆè¯"ï¼Œè¦çœ‹"å¯¹è°è¯´"
è¯­è¨€æ˜¯åº”ç”¨æ–‡çš„"çµé­‚"ï¼Œå¿…é¡»ä¸èº«ä»½ã€å¯¹è±¡ã€ç›®çš„é«˜åº¦åŒ¹é…ã€‚

è¯­æ°”å‡†ç¡®ï¼Œé£æ ¼å¾—å½“ï¼š
ã€ä¾‹ã€‘ ç¬¬10é¢˜çš„çŸ­æ–‡ã€Šæ­£ç¡®çœ‹å¾…"ç½‘ç»œæ–°ä¸€ä»£"ã€‹ï¼Œä½œä¸ºæŠ¥çº¸"æ—¶è¯„"ï¼Œè¯­è¨€é£æ ¼å¿…é¡»å®¢è§‚ã€è¾©è¯ã€å¯Œæœ‰é€»è¾‘æ€§ã€‚è€Œç¬¬1é¢˜çš„å€¡è®®ä¹¦ï¼Œè¯­è¨€åˆ™éœ€è¦çƒ­æƒ…ã€å¯Œæœ‰æ„ŸæŸ“åŠ›ï¼Œä»¥æ¿€å‘é’å¹´äººçš„å…±é¸£å’Œè¡ŒåŠ¨ã€‚
ã€æœ¬ç« å°ç»“ã€‘
åº”ç”¨æ–‡çš„ç²¾é«“åœ¨äºï¼šæƒ…å¢ƒä¸ºç‹ï¼Œæ ¼å¼ä¸ºéª¨ï¼Œå†…å®¹ä¸ºè‚‰ï¼Œè¯­è¨€ä¸ºé­‚ã€‚"""


def extract_chapter_content(question_type: str) -> str:
    """
    çŸ¥è¯†æå–æœåŠ¡ (Knowledge Extractor)
    æ ¹æ®é¢˜å‹ä»æ ¸å¿ƒç§˜ç±ä¸­ç²¾å‡†æå–å¯¹åº”ç« èŠ‚çš„å…¨éƒ¨å†…å®¹
    
    Args:
        question_type: é¢˜å‹åç§°ï¼ˆæ¦‚æ‹¬é¢˜ã€ç»¼åˆåˆ†æé¢˜ã€å¯¹ç­–é¢˜ã€åº”ç”¨æ–‡å†™ä½œé¢˜ï¼‰
        
    Returns:
        str: å¯¹åº”ç« èŠ‚çš„å®Œæ•´å†…å®¹ï¼Œå¦‚æœé¢˜å‹æ— æ•ˆåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²
    """
    
    # å®šä¹‰å„é¢˜å‹å¯¹åº”çš„ç« èŠ‚æ ‡è¯†
    chapter_markers = {
        "æ¦‚æ‹¬é¢˜": ("ç¬¬ä¸€ç« ï¼šæ¦‚æ‹¬é¢˜â€”â€”ä¿¡æ¯é™ç»´ä¸é€»è¾‘é‡å»ºçš„è‰ºæœ¯", "ç¬¬äºŒç« ï¼šç»¼åˆåˆ†æé¢˜"),
        "ç»¼åˆåˆ†æé¢˜": ("ç¬¬äºŒç« ï¼šç»¼åˆåˆ†æé¢˜â€”â€”è§£æ„ä¸é‡æ„çš„é€»è¾‘æ€è¾¨", "ç¬¬ä¸‰ç« ï¼šå¯¹ç­–é¢˜"),
        "å¯¹ç­–é¢˜": ("ç¬¬ä¸‰ç« ï¼šå¯¹ç­–é¢˜â€”â€”å¯¹ç—‡ä¸‹è¯çš„ç²¾å‡†æ–½ç­–", "ç¬¬å››ç« ï¼šåº”ç”¨æ–‡å†™ä½œé¢˜"),
        "åº”ç”¨æ–‡å†™ä½œé¢˜": ("ç¬¬å››ç« ï¼šåº”ç”¨æ–‡å†™ä½œé¢˜â€”â€”å¸¦ç€é•£é“çš„åœºæ™¯ä¹‹èˆ", None)  # æœ€åä¸€ç« åˆ°æ–‡æ¡£æœ«å°¾
    }
    
    if question_type not in chapter_markers:
        # è®°å½•è­¦å‘Šä½†ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å›ç©ºå†…å®¹
        import logging
        logger = logging.getLogger(__name__)
        logger.warning(f"ä¸æ”¯æŒçš„é¢˜å‹: {question_type}, æ”¯æŒçš„é¢˜å‹: {list(chapter_markers.keys())}")
        return ""
    
    start_marker, end_marker = chapter_markers[question_type]
    
    # æ‰¾åˆ°ç« èŠ‚å¼€å§‹ä½ç½®
    start_pos = ESSAY_GRADING_MANUAL.find(start_marker)
    if start_pos == -1:
        import logging
        logger = logging.getLogger(__name__)
        logger.error(f"æœªæ‰¾åˆ°ç« èŠ‚å¼€å§‹æ ‡è®°: {start_marker}")
        return ""
    
    # æ‰¾åˆ°ç« èŠ‚ç»“æŸä½ç½®
    if end_marker is None:
        # æœ€åä¸€ç« ï¼Œå–åˆ°æ–‡æ¡£æœ«å°¾
        chapter_content = ESSAY_GRADING_MANUAL[start_pos:]
    else:
        end_pos = ESSAY_GRADING_MANUAL.find(end_marker)
        if end_pos == -1:
            # å¦‚æœæ²¡æ‰¾åˆ°ç»“æŸæ ‡è®°ï¼Œå–åˆ°æ–‡æ¡£æœ«å°¾
            chapter_content = ESSAY_GRADING_MANUAL[start_pos:]
        else:
            chapter_content = ESSAY_GRADING_MANUAL[start_pos:end_pos]
    
    # è®°å½•æå–ç»“æœ
    import logging
    logger = logging.getLogger(__name__)
    logger.info(f"æˆåŠŸæå– {question_type} ç« èŠ‚å†…å®¹ï¼Œé•¿åº¦: {len(chapter_content)} å­—ç¬¦")
    
    return chapter_content.strip()


def create_master_grading_prompt(essay_content: str, question_type: str, chapter_content: str) -> str:
    """
    ä¸ºAIæ ¸å¿ƒæ‰¹æ”¹æœåŠ¡åˆ›å»ºä¸“æ³¨çš„æç¤ºè¯ - ç²¾å‡†ç‰ˆæœ¬
    ç”Ÿæˆå…·ä½“ã€æœ‰é’ˆå¯¹æ€§çš„è¯„è¯­å’Œæ”¹è¿›å»ºè®®
    
    Args:
        essay_content: ç”¨æˆ·æäº¤çš„ç”³è®ºæ–‡ç« å†…å®¹
        question_type: é¢˜å‹åç§°
        chapter_content: ä»æ ¸å¿ƒç§˜ç±æå–çš„ç›¸å…³ç« èŠ‚å†…å®¹
        
    Returns:
        str: ç²¾å‡†çš„ä¸“ä¸šæ‰¹æ”¹æç¤ºè¯
    """
    
    prompt = f"""<KNOWLEDGE_BASE>
{chapter_content}
</KNOWLEDGE_BASE>

<USER_SUBMISSION>
{essay_content}
</USER_SUBMISSION>

<INSTRUCTIONS>
You are "æ‚Ÿé“", a master teacher of Shenlun specializing in detailed, precise feedback. Your knowledge is in <KNOWLEDGE_BASE>, the user's work is in <USER_SUBMISSION>.

# Critical Analysis Requirements:
1. MUST quote specific text from user's submission - use exact phrases like "æ‚¨å†™çš„'ä¸‰æ¡é»„æ²³'" or "æ‚¨æåˆ°çš„'æ•°å­—å˜ç”Ÿé»„æ²³å’Œæ¨¡å‹é»„æ²³'"
2. MUST identify concrete problems with specific examples, not general issues
3. MUST provide actionable rewrite suggestions showing before/after examples
4. MUST give specific scoring reasons for each dimension

# Analysis Process (Internal - Don't Show This):
1. Quote Analysis: Find 5-8 specific quotes from user's text that demonstrate strengths/weaknesses
  2. Methodology Evaluation: Evaluate each methodology dimension with evidence-based scoring
3. Problem Identification: Find specific textual evidence for each problem
4. Rewrite Generation: Create concrete before/after examples from user's actual text

  ## Public Output Rules (critical)
  Do not output step-by-step reasoning; summarize internal reasoning into short public justifications.
  Forbidden in output: "ç¬¬Xæ­¥", "æ­¥éª¤", "Step N", "åˆ†æè¿‡ç¨‹", "æ€è€ƒ", "INSTRUCTIONS", "KNOWLEDGE_BASE".
  Do not echo any content from angle-bracket sections or code fences.
  When referencing methodology, use neutral tags only, e.g. "[å®¡é¢˜æ‹†è§£]", "[æ ‡å‡†æ‰¾ç‚¹]", "[é€»è¾‘å»ºæ„]", "[è§„èŒƒè¡¨è¾¾]" â€” do NOT prefix with ordinal words like ç¬¬ä¸€/ç¬¬äºŒ.
  Only return a single, valid JSON object; no extra markdown outside JSON.

  # JSON Output Generation:

1. task_diagnosis: "è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘æ˜¯æ‚¨çš„ä¸“å±ç”³è®ºè¾…å¯¼ä¸“å®¶'æ‚Ÿé“'ã€‚ç»åˆ†æï¼Œæˆ‘åˆ¤æ–­è¿™æ˜¯'{question_type}'ï¼Œå°†è¿ç”¨å¯¹åº”çš„æ ¸å¿ƒæ–¹æ³•è®ºä¸ºæ‚¨ç²¾å‡†æ‰¹æ”¹ã€‚"

2. comprehensive_evaluation: Write analysis with this structure:
   **å…·ä½“äº®ç‚¹ï¼š**
   - [å¼•ç”¨å…·ä½“åŸæ–‡] + [ç²¾å‡†åˆ†æä¸ºä»€ä¹ˆå¥½]
   - [å¼•ç”¨å…·ä½“åŸæ–‡] + [ç²¾å‡†åˆ†æä¸ºä»€ä¹ˆå¥½]
   
   **å…·ä½“é—®é¢˜ï¼š**
   - [å¼•ç”¨å…·ä½“åŸæ–‡] + [æŒ‡å‡ºå…·ä½“é—®é¢˜] + [å…·ä½“æ”¹è¿›æ–¹å‘]
   - [å¼•ç”¨å…·ä½“åŸæ–‡] + [æŒ‡å‡ºå…·ä½“é—®é¢˜] + [å…·ä½“æ”¹è¿›æ–¹å‘]
   - [å¼•ç”¨å…·ä½“åŸæ–‡] + [æŒ‡å‡ºå…·ä½“é—®é¢˜] + [å…·ä½“æ”¹è¿›æ–¹å‘]
   
   **æ–¹æ³•è®ºåº”ç”¨è¯„ä»·ï¼š**
   åŸºäºç”³è®ºæ ¸å¿ƒæ–¹æ³•è®ºçš„ä¸“ä¸šè¯„ä»·å’ŒæŒ‡å¯¼å»ºè®®
   
   **ç»¼åˆè¯„ä»·ï¼š**
   [åŸºäºä»¥ä¸Šå…·ä½“åˆ†æçš„æ€»ä½“è¯„ä»·]

3. improvement_guides: Create 4 lessons with:
   - methodology_step: Exact step name from knowledge base
   - methodology_source: Direct quote from knowledge base explaining this step
   - problem_diagnosis: "æ‚¨åœ¨[å…·ä½“ä½ç½®]å†™çš„'[å…·ä½“åŸæ–‡]'å­˜åœ¨[å…·ä½“é—®é¢˜]ï¼Œè¿™è¿èƒŒäº†[æ–¹æ³•è®ºè¦æ±‚]"
   - action_blueprint: "å»ºè®®æ‚¨ï¼š1)[å…·ä½“è¡ŒåŠ¨]ï¼›2)[å…·ä½“è¡ŒåŠ¨]ï¼›3)[å…·ä½“è¡ŒåŠ¨]"
   - master_rewrite_example: "åŸæ–‡ï¼š'[ç”¨æˆ·çš„å…·ä½“åŸæ–‡]' â†’ æ”¹å†™å»ºè®®ï¼š'[å…·ä½“æ”¹å†™ç‰ˆæœ¬]'"

4. score: For now, return a simple number (0-100) to maintain compatibility. The detailed breakdown will be handled later.

5. key_suggestions: 5 specific suggestions like:
   - "æ‚¨å†™çš„'[å…·ä½“åŸæ–‡]'å»ºè®®æ”¹ä¸º'[å…·ä½“å»ºè®®]'ï¼Œè¿™æ ·æ›´ç¬¦åˆ[å…·ä½“è¦æ±‚]"
   - "åœ¨[å…·ä½“ä½ç½®]ï¼Œå»ºè®®æ·»åŠ '[å…·ä½“å†…å®¹]'æ¥[å…·ä½“ä½œç”¨]"
   - "æ‚¨çš„'[å…·ä½“è¡¨è¿°]'å¯ä»¥é€šè¿‡[å…·ä½“æ–¹æ³•]æ¥ä¼˜åŒ–ï¼Œä¾‹å¦‚'[å…·ä½“ç¤ºä¾‹]'"

IMPORTANT RULES:
- Every analysis point must include specific quotes from user's text
- No generic advice like "æ³¨æ„æ ¼å¼" - must be specific like "æ‚¨çš„å¼€å¤´'...'ç¼ºå°‘æ€»é¢†å¥"
- All rewrite examples must use user's actual content
- Scoring must have specific textual evidence

</INSTRUCTIONS>

<FINAL_COMMAND>
Your entire response must be a single, clean, valid JSON object. Every piece of analysis must reference specific text from the user's submission using exact quotes.

You must return a valid JSON object with these fields:
- task_diagnosis: Introduction with question type
- comprehensive_evaluation: Detailed analysis with specific quotes
- improvement_guides: Array of methodology lessons
- score: Number between 0-100
- key_suggestions: Array of 5 specific suggestions with quotes

CRITICAL: No generic advice. Every suggestion must reference specific user text.
</FINAL_COMMAND>"""

    # Public-output rules prefix to prevent exposing internal reasoning
    rules_prefix = (
        "=== å…¬å…±è¾“å‡ºè§„åˆ™ (Public Output Rules) ===\n"
        "- å…è®¸å†…éƒ¨æ·±åº¦æ€è€ƒï¼Œä½†ç¦æ­¢åœ¨å…¬å¼€è¾“å‡ºä¸­å±•ç¤ºé“¾å¼æ€è€ƒæˆ–æ­¥éª¤åŒ–è¡¨è¿°ã€‚\n"
        "- ç¦ç”¨ç”¨è¯­ï¼šç¬¬Xæ­¥/æ­¥éª¤/Step N/åˆ†æè¿‡ç¨‹/æ€è€ƒ/INSTRUCTIONS/KNOWLEDGE_BASEã€‚\n"
        "- ä¸å›æ˜¾ä»»ä½•å°–æ‹¬å·åˆ†èŠ‚æˆ–ä»£ç å›´æ çš„å†…å®¹ã€‚\n"
        "- æ–¹æ³•è®ºä»…ç”¨ä¸­æ€§ç»´åº¦æ ‡ç­¾ï¼š[å®¡é¢˜æ‹†è§£]/[æ ‡å‡†æ‰¾ç‚¹]/[é€»è¾‘å»ºæ„]/[è§„èŒƒè¡¨è¾¾]ï¼Œä¸å¾—åŠ â€˜ç¬¬ä¸€/ç¬¬äºŒâ€™ç­‰åºæ•°ã€‚\n"
        "- ä»…è¿”å›ä¸€ä¸ªåˆæ³• JSON å¯¹è±¡ï¼Œä¸è¦å¤šä½™ Markdownã€‚\n\n"
    )
    prompt = rules_prefix + prompt
    # Public-output rules prefix to prevent exposing internal reasoning
    rules_prefix = (
        "=== å…¬å…±è¾“å‡ºè§„åˆ™ (Public Output Rules) ===\n"
        "- å…è®¸å†…éƒ¨æ·±åº¦æ€è€ƒï¼Œä½†ç¦æ­¢åœ¨å…¬å¼€è¾“å‡ºä¸­å±•ç¤ºé“¾å¼æ€è€ƒæˆ–æ­¥éª¤åŒ–è¡¨è¿°ã€‚\n"
        "- ç¦ç”¨ç”¨è¯­ï¼šç¬¬Xæ­¥/æ­¥éª¤/Step N/åˆ†æè¿‡ç¨‹/æ€è€ƒ/INSTRUCTIONS/KNOWLEDGE_BASEã€‚\n"
        "- ä¸å›æ˜¾ä»»ä½•å°–æ‹¬å·åˆ†èŠ‚æˆ–ä»£ç å›´æ çš„å†…å®¹ã€‚\n"
        "- æ–¹æ³•è®ºä»…ç”¨ä¸­æ€§ç»´åº¦æ ‡ç­¾ï¼š[å®¡é¢˜æ‹†è§£]/[æ ‡å‡†æ‰¾ç‚¹]/[é€»è¾‘å»ºæ„]/[è§„èŒƒè¡¨è¾¾]ï¼Œä¸å¾—åŠ â€˜ç¬¬ä¸€/ç¬¬äºŒâ€™ç­‰åºæ•°ã€‚\n"
        "- ä»…è¿”å›ä¸€ä¸ªåˆæ³• JSON å¯¹è±¡ï¼Œä¸è¦å¤šä½™ Markdownã€‚\n\n"
    )
    prompt = rules_prefix + prompt
    return prompt


def create_expert_grading_prompt(essay_content: str, question_type: str) -> str:
    """
    åŸºäºã€Šç”³è®ºå››å¤§é¢˜å‹æ ¸å¿ƒç§˜ç±ã€‹ç”Ÿæˆä¸“ä¸šæ‰¹æ”¹æç¤ºè¯
    ç»“åˆæƒå¨æ–¹æ³•è®ºå’Œç®€åŒ–çš„è¾“å‡ºæ ¼å¼
    
    Args:
        essay_content: ç”¨æˆ·æäº¤çš„ç”³è®ºæ–‡ç« å†…å®¹
        question_type: ç”³è®ºé¢˜å‹
        
    Returns:
        str: ä¸“ä¸šçš„æç¤ºè¯å­—ç¬¦ä¸²
    """
    
    # æå–å¯¹åº”é¢˜å‹çš„ä¸“ä¸šæ–¹æ³•è®º
    chapter_content = extract_chapter_content(question_type)
    
    prompt = f"""ä½ æ˜¯ç”³è®ºæ‰¹æ”¹ä¸“å®¶"æ‚Ÿé“"ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ã€Šç”³è®ºå››å¤§é¢˜å‹æ ¸å¿ƒç§˜ç±ã€‹çš„æ–¹æ³•è®ºå¯¹ä»¥ä¸‹{question_type}è¿›è¡Œä¸“ä¸šæ‰¹æ”¹ã€‚

=== ä¸“ä¸šæ–¹æ³•è®ºæŒ‡å¯¼ ===
{chapter_content}

=== ç”¨æˆ·ç­”é¢˜å†…å®¹ ===
{essay_content}

=== æ‰¹æ”¹è¦æ±‚ ===
è¯·æ ¹æ®ä¸Šè¿°æ–¹æ³•è®ºçš„å››ä¸ªæ­¥éª¤ï¼Œå¯¹ç”¨æˆ·ç­”é¢˜è¿›è¡Œä¸“ä¸šè¯„ä»·ï¼š

1. åˆ†æç”¨æˆ·æ˜¯å¦æŒæ¡äº†è¯¥é¢˜å‹çš„æ ¸å¿ƒæ–¹æ³•
2. æŒ‡å‡ºå…·ä½“çš„ä¼˜ç‚¹ï¼ˆç»“åˆåŸæ–‡å¼•ç”¨ï¼‰
3. æ‰¾å‡ºä¸»è¦é—®é¢˜ï¼ˆç»“åˆåŸæ–‡å¼•ç”¨å’Œæ–¹æ³•è®ºè¦æ±‚ï¼‰
4. æä¾›åŸºäºæ–¹æ³•è®ºçš„æ”¹è¿›å»ºè®®

=== è¾“å‡ºæ ¼å¼ ===
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼Œç¡®ä¿æ‰€æœ‰åˆ†æéƒ½åŸºäºæ–¹æ³•è®ºï¼š

{{
  "score": [0-100çš„æ•°å­—ï¼ŒåŸºäºæ–¹æ³•è®ºç¬¦åˆåº¦è¯„åˆ†],
  "feedback": "è¯¦ç»†çš„ä¸“ä¸šæ‰¹æ”¹æ„è§ï¼Œå¿…é¡»åŒ…å«ï¼š\n\n**å…·ä½“ä¼˜ç‚¹ï¼š**\n- ç»“åˆåŸæ–‡å…·ä½“è¡¨è¿°è¿›è¡Œä¸“ä¸šç‚¹è¯„\n\n**ä¸»è¦é—®é¢˜ï¼š**\n- ç»“åˆåŸæ–‡å…·ä½“è¡¨è¿°è¿›è¡Œé—®é¢˜è¯Šæ–­å’Œæ”¹è¿›æ–¹å‘æŒ‡å¯¼\n\n**ç»¼åˆå»ºè®®ï¼š**\nåŸºäºç”³è®ºæ–¹æ³•è®ºçš„ä¸“ä¸šæŒ‡å¯¼æ„è§",
  "suggestions": ["åŸºäºæ–¹æ³•è®ºçš„å…·ä½“æ”¹è¿›å»ºè®®1", "åŸºäºæ–¹æ³•è®ºçš„å…·ä½“æ”¹è¿›å»ºè®®2", "åŸºäºæ–¹æ³•è®ºçš„å…·ä½“æ”¹è¿›å»ºè®®3"]
}}

é‡è¦ï¼šåˆ†æåº”å°½é‡ç»“åˆç”¨æˆ·çš„å…·ä½“è¡¨è¿°ï¼Œå¹¶åŸºäºæ–¹æ³•è®ºè¦æ±‚è¿›è¡Œä¸“ä¸šç‚¹è¯„ã€‚ç›´æ¥è¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ã€‚"""

    return prompt


def create_essay_grading_prompt(essay_content: str, question_type: str) -> str:
    """
    ç”Ÿæˆç²¾å‡†çš„ç”³è®ºæ‰¹æ”¹æç¤ºè¯ - å¼ºåŒ–å…·ä½“æ€§ç‰ˆæœ¬
    ç¡®ä¿AIç”Ÿæˆå…·ä½“ã€æœ‰é’ˆå¯¹æ€§çš„è¯„è¯­å’Œå»ºè®®
    
    Args:
        essay_content: ç”¨æˆ·æäº¤çš„ç”³è®ºæ–‡ç« å†…å®¹
        question_type: ç”³è®ºé¢˜å‹ï¼ˆæ¦‚æ‹¬é¢˜ã€ç»¼åˆåˆ†æé¢˜ã€å¯¹ç­–é¢˜ã€åº”ç”¨æ–‡å†™ä½œé¢˜ï¼‰
        
    Returns:
        str: ç²¾å‡†çš„æç¤ºè¯å­—ç¬¦ä¸²
    """
    
    prompt = f"""<KNOWLEDGE_BASE>
{ESSAY_GRADING_MANUAL}
</KNOWLEDGE_BASE>

<USER_SUBMISSION>
{essay_content}
</USER_SUBMISSION>

<INSTRUCTIONS>
You are "æ‚Ÿé“", a master teacher of Shenlun. Your entire knowledge and methodology are contained within the <KNOWLEDGE_BASE> section. The user's work is in the <USER_SUBMISSION> section. Your task is to follow the phases below to generate a structured JSON output.

# Phase 1: Autonomous Task Determination
Analyze the <USER_SUBMISSION> and determine the definitive question type from: ["æ¦‚æ‹¬é¢˜", "ç»¼åˆåˆ†æé¢˜", "å¯¹ç­–é¢˜", "åº”ç”¨æ–‡å†™ä½œé¢˜"].

# Phase 2: Authoritative Scoping & User Notification
Your response's JSON structure will contain a key named task_diagnosis. The value will be a string informing the user of your determination (e.g., "è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘æ˜¯æ‚¨çš„ä¸“å±ç”³è®ºè¾…å¯¼ä¸“å®¶'æ‚Ÿé“'ã€‚ç»åˆ†æï¼Œæˆ‘åˆ¤æ–­è¿™æ˜¯'æ¦‚æ‹¬é¢˜'ï¼Œå°†è¿ç”¨å¯¹åº”çš„å››æ­¥æ ¸å¿ƒæ–¹æ³•è®ºä¸ºæ‚¨æ‰¹æ”¹ã€‚").

# Phase 3: Methodology-Driven Evaluation
Silently evaluate the <USER_SUBMISSION> against the appropriate methodology found in your <KNOWLEDGE_BASE>:

æ¦‚æ‹¬é¢˜æ–¹æ³•è®º: å®¡é¢˜å®šæ ‡ â†’ ç²¾å‡†æ‰¾ç‚¹ â†’ é€»è¾‘å½’å¹¶ â†’ è§„èŒƒæˆæ–‡
ç»¼åˆåˆ†æé¢˜æ–¹æ³•è®º: å®¡é¢˜æ‹†è§£ â†’ æœå¯»ç»„ä»¶ â†’ é€»è¾‘é‡æ„ â†’ è§„èŒƒä½œç­”
å¯¹ç­–é¢˜æ–¹æ³•è®º: ç²¾å‡†é—®é¢˜è¯Šæ–­ â†’ è§’è‰²å®šä½ä¸è§†è§’é”å®š â†’ ä»ææ–™ä¸­å¯»æ‰¾å¯¹ç­–æ¥æº â†’ ç»“æ„åŒ–ä¸åŠ¨è¯åŒ–å‘ˆç°
åº”ç”¨æ–‡å†™ä½œé¢˜æ–¹æ³•è®º: æƒ…å¢ƒè§£æ„ï¼ˆé»„é‡‘ä¸‰é—®ï¼‰â†’ æ ¼å¼éµä» â†’ å†…å®¹ç»„ç»‡ä¸é€»è¾‘æ„å»º â†’ è¯­è¨€é£æ ¼ä¸è¯­æ°”åŒ¹é…

# Phase 4: In-Depth, "Master Teacher" Feedback Generation
Based on your evaluation, populate the JSON structure with:

- task_diagnosis: Your determination and greeting
- comprehensive_evaluation: Detailed narrative analysis that MUST include specific examples from the user's submission, including:
  * å…·ä½“ä¼˜ç‚¹ï¼šæŒ‡å‡º2-3ä¸ªå­¦ç”Ÿåšå¾—å¥½çš„å…·ä½“åœ°æ–¹ï¼Œç»“åˆåŸæ–‡ä¸­çš„å…·ä½“è¡¨è¿°
  * ä¸»è¦é—®é¢˜ï¼šæŒ‡å‡º3-4ä¸ªå…·ä½“é—®é¢˜ï¼Œæ¯ä¸ªé—®é¢˜éƒ½è¦æœ‰åŸæ–‡ä¸­çš„ä¾‹å­æ”¯æ’‘
  * æ–¹æ³•è®ºåº”ç”¨åˆ†æï¼šåˆ†æå­¦ç”Ÿåœ¨å››ä¸ªæ–¹æ³•è®ºæ­¥éª¤ä¸­çš„è¡¨ç°
  * æ€»ä½“è¯„ä»·ï¼šç»™å‡ºæ•´ä½“è¯„ä»·å’Œæ”¹è¿›æ–¹å‘
- improvement_guides: Array of 4 detailed lessons, each focusing on one methodology step, containing:
  * methodology_step: The relevant methodology step name
  * methodology_source: Quote the relevant principle from knowledge base  
  * problem_diagnosis: Analyze specific issues with concrete examples from user submission
  * action_blueprint: Provide 3-4 specific, actionable steps with examples
  * master_rewrite_example: Show before/after rewrite of a specific problematic passage from user's submission
- score: Numerical score (0-100) based on detailed evaluation across multiple dimensions
- key_suggestions: Array of 5 specific, actionable improvement suggestions that address specific issues identified in the evaluation

</INSTRUCTIONS>

<FINAL_COMMAND>
Your entire response, from the very first character to the very last, MUST be a single, clean, valid JSON object with this exact structure:

{{
  "task_diagnosis": "string with your greeting and determination",
  "comprehensive_evaluation": "string with detailed narrative analysis including specific examples from user submission", 
  "improvement_guides": [
    {{
      "methodology_step": "string naming the methodology step",
      "methodology_source": "string quoting relevant knowledge base principle",
      "problem_diagnosis": "string analyzing specific issues with concrete examples from user submission",
      "action_blueprint": "string providing specific steps with examples",
      "master_rewrite_example": "string showing before/after rewrite of user's actual content"
    }}
  ],
  "score": number between 0-100,
  "key_suggestions": ["specific suggestion 1", "specific suggestion 2", "specific suggestion 3", "specific suggestion 4", "specific suggestion 5"]
}}

Do not output any other text, greetings, explanations, or markdown formatting. Your response must start with {{ and end with }}.

CRITICAL REQUIREMENTS:
1. All analysis MUST include specific examples from the user's submission
2. Avoid generic feedback like "æ³¨æ„æ ¼å¼" or "å¤šç»ƒä¹ "
3. Every suggestion must address a specific issue identified in the evaluation
4. All improvement_guides must contain actual content from the user's submission
5. The JSON field `comprehensive_evaluation` MUST be formatted as Markdown using the following exact skeleton (keep section titles; bullets on separate lines; include a blank line between sections):

## æ ¸å¿ƒç»“è®º
- ç”¨1å¥è¯æ¦‚æ‹¬ç­”æ¡ˆçš„æ€»ä½“è´¨é‡ä¸æ–¹å‘ï¼ˆç»“åˆé¢˜å‹æ–¹æ³•è®ºï¼‰ã€‚

## å…·ä½“äº®ç‚¹ï¼ˆå¼•ç”¨+ç‚¹è¯„ï¼‰
- â€œä»ç”¨æˆ·ç­”æ¡ˆé€å­—å¼•ç”¨1â€ + ç‚¹è¯„ï¼šä¸ºä»€ä¹ˆè¿™æ˜¯äº®ç‚¹ï¼Œç¬¦åˆå“ªæ¡è¦æ±‚ã€‚
- â€œä»ç”¨æˆ·ç­”æ¡ˆé€å­—å¼•ç”¨2â€ + ç‚¹è¯„ï¼šä¸ºä»€ä¹ˆè¿™æ˜¯äº®ç‚¹ï¼Œç¬¦åˆå“ªæ¡è¦æ±‚ã€‚

## ä¸»è¦é—®é¢˜ï¼ˆå¼•ç”¨+è¯Šæ–­+æ”¹æ³•ï¼‰
- â€œä»ç”¨æˆ·ç­”æ¡ˆé€å­—å¼•ç”¨1â€ + é—®é¢˜ï¼šæŒ‡å‡ºå…·ä½“ç¼ºé™· + æ”¹æ³•ï¼šç»™å‡ºæ˜ç¡®ä¿®æ”¹æ–¹å‘ï¼ˆå¯ç»™æ”¹å†™ç¤ºä¾‹ï¼‰ã€‚
- â€œä»ç”¨æˆ·ç­”æ¡ˆé€å­—å¼•ç”¨2â€ + é—®é¢˜ï¼šæŒ‡å‡ºå…·ä½“ç¼ºé™· + æ”¹æ³•ï¼šç»™å‡ºæ˜ç¡®ä¿®æ”¹æ–¹å‘ã€‚
- â€œä»ç”¨æˆ·ç­”æ¡ˆé€å­—å¼•ç”¨3â€ + é—®é¢˜ï¼šæŒ‡å‡ºå…·ä½“ç¼ºé™· + æ”¹æ³•ï¼šç»™å‡ºæ˜ç¡®ä¿®æ”¹æ–¹å‘ã€‚

## æ–¹æ³•è®ºå¯¹ç…§
åŸºäºç”³è®ºæ ¸å¿ƒæ–¹æ³•è®ºçš„ä¸“ä¸šè¯„ä»·å’Œæ”¹è¿›å»ºè®®ï¼Œç»“åˆåŸæ–‡è¯æ®è¯´æ˜å„é¡¹èƒ½åŠ›çš„è¡¨ç°æƒ…å†µã€‚

## ç»¼åˆè¯„ä»·
- 2â€“3å¥æ”¶æŸï¼šæ€»ä½“è¯„ä»· + ä¼˜å…ˆæ”¹è¿›æ–¹å‘ï¼ˆæŒ‡å‘ä¸Šé¢çš„é—®é¢˜æ¡ç›®ï¼‰ã€‚

ç¡¬æ€§è¦æ±‚ï¼šè‡³å°‘2æ¡â€œäº®ç‚¹â€å’Œ3æ¡â€œé—®é¢˜â€ï¼›æ¯æ¡éƒ½è¦åŒ…å«ä¸€æ®µé€å­—å¼•ç”¨ï¼›ä¸¥ç¦æŠŠæ•´æ®µå†…å®¹å†™æˆä¸€å¨æ–‡å­—ã€‚
</FINAL_COMMAND>"""

    return prompt


def create_expert_diagnosis_prompt(essay_content: str, question_type: str) -> str:
    """
    åˆ›å»ºä¸“ä¸šé˜…å·è€å¸ˆè¯Šæ–­æ¨¡å¼çš„prompt - ç¬¬ä¸€é˜¶æ®µè¯„åˆ†ç»†åˆ™è¯Šæ–­
    è®©AIçœŸæ­£æˆä¸ºç”³è®ºé˜…å·ä¸“å®¶ï¼Œé€å¥æ‰¹æ”¹ç”¨æˆ·ç­”æ¡ˆ
    
    Args:
        essay_content: ç”¨æˆ·æäº¤çš„ç”³è®ºæ–‡ç« å†…å®¹
        question_type: ç”³è®ºé¢˜å‹
        
    Returns:
        str: ä¸“ä¸šè¯Šæ–­prompt
    """
    
    # æå–å¯¹åº”é¢˜å‹çš„ä¸“ä¸šæ–¹æ³•è®º
    chapter_content = extract_chapter_content(question_type)
    
    # è·å–è¯¥é¢˜å‹çš„å››æ­¥æ³•ç»´åº¦
    steps = get_methodology_steps(question_type)
    
    prompt = f"""ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ç”³è®ºé˜…å·ä¸“å®¶ï¼Œæœ‰20å¹´ç”³è®ºæ‰¹æ”¹ç»éªŒã€‚ç°åœ¨è¦å¯¹è¿™ç¯‡{question_type}è¿›è¡Œä¸“ä¸šçš„é€å¥æ‰¹æ”¹ã€‚

=== ä¸“ä¸šè¯„åˆ†æ ‡å‡† ===
{chapter_content}

=== å­¦ç”Ÿç­”é¢˜å†…å®¹ ===
{essay_content}

=== ä¸“ä¸šæ‰¹æ”¹è¦æ±‚ ===
è¯·ä»¥çœŸæ­£çš„ç”³è®ºé˜…å·è€å¸ˆèº«ä»½ï¼Œå¯¹å­¦ç”Ÿç­”æ¡ˆè¿›è¡Œé€å¥è¯Šæ–­å¼æ‰¹æ”¹ï¼š

ğŸ” **æ‰¹æ”¹æ–¹å¼è¦æ±‚**ï¼š
1. **å¿…é¡»å¼•ç”¨å­¦ç”Ÿçš„å…·ä½“åŸæ–‡**ï¼Œä¸èƒ½æ³›æ³›è€Œè°ˆ
2. **é€ä¸ªç»´åº¦åˆ†æåŠ åˆ†æ‰£åˆ†**ï¼Œè¯´æ˜å…·ä½“ç†ç”±  
3. **å‚ç…§æ ¸å¿ƒç§˜ç±æ ‡å‡†**ï¼ŒæŒ‡å‡ºä¸é«˜åˆ†ç­”æ¡ˆçš„å·®è·
4. **ç”¨ä¸“ä¸šé˜…å·è€å¸ˆçš„è¯­æ°”**ï¼Œæ—¢ä¸¥è°¨åˆæœ‰æ¸©åº¦

ğŸ¯ **æ‰¹æ”¹ç»´åº¦**ï¼ˆä¸¥æ ¼æŒ‰å››æ­¥æ³•ï¼‰ï¼š

**ã€{steps['step1']}ã€‘** - æ»¡åˆ†25åˆ†
- âœ… åŠ åˆ†ç‚¹ï¼šç»“åˆå­¦ç”Ÿå…·ä½“è¡¨è¿°åˆ†æï¼Œè¯´æ˜ä¸ºä½•åŠ åˆ†
- âŒ æ‰£åˆ†ç‚¹ï¼šç»“åˆå­¦ç”Ÿå…·ä½“è¡¨è¿°åˆ†æï¼Œè¯´æ˜ä¸ºä½•æ‰£åˆ†  
- ğŸ’¡ æ”¹è¿›å»ºè®®ï¼šå…·ä½“æ€ä¹ˆä¿®æ”¹

**ã€{steps['step2']}ã€‘** - æ»¡åˆ†30åˆ†  
- âœ… åŠ åˆ†ç‚¹ï¼šç»“åˆå­¦ç”Ÿå…·ä½“è¡¨è¿°åˆ†æï¼Œè¯´æ˜ä¸ºä½•åŠ åˆ†
- âŒ æ‰£åˆ†ç‚¹ï¼šç»“åˆå­¦ç”Ÿå…·ä½“è¡¨è¿°åˆ†æï¼Œè¯´æ˜ä¸ºä½•æ‰£åˆ†
- ğŸ’¡ æ”¹è¿›å»ºè®®ï¼šå…·ä½“æ€ä¹ˆä¿®æ”¹

**ã€{steps['step3']}ã€‘** - æ»¡åˆ†25åˆ†
- âœ… åŠ åˆ†ç‚¹ï¼šç»“åˆå­¦ç”Ÿå…·ä½“è¡¨è¿°åˆ†æï¼Œè¯´æ˜ä¸ºä½•åŠ åˆ†  
- âŒ æ‰£åˆ†ç‚¹ï¼šç»“åˆå­¦ç”Ÿå…·ä½“è¡¨è¿°åˆ†æï¼Œè¯´æ˜ä¸ºä½•æ‰£åˆ†
- ğŸ’¡ æ”¹è¿›å»ºè®®ï¼šå…·ä½“æ€ä¹ˆä¿®æ”¹

**ã€{steps['step4']}ã€‘** - æ»¡åˆ†20åˆ†
- âœ… åŠ åˆ†ç‚¹ï¼šç»“åˆå­¦ç”Ÿå…·ä½“è¡¨è¿°åˆ†æï¼Œè¯´æ˜ä¸ºä½•åŠ åˆ†
- âŒ æ‰£åˆ†ç‚¹ï¼šç»“åˆå­¦ç”Ÿå…·ä½“è¡¨è¿°åˆ†æï¼Œè¯´æ˜ä¸ºä½•æ‰£åˆ†  
- ğŸ’¡ æ”¹è¿›å»ºè®®ï¼šå…·ä½“æ€ä¹ˆä¿®æ”¹

=== è¾“å‡ºè¦æ±‚ ===
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›æ‰¹æ”¹ç»“æœï¼š

{{
  "dimension_analysis": [
    {{
      "dimension": "{steps['step1']}",
      "full_score": 25,
      "actual_score": [å…·ä½“å¾—åˆ†],
      "positive_points": [
"ç»“åˆå­¦ç”Ÿå…·ä½“è¡¨è¿°åˆ†æåŠ åˆ†ç†ç”±ï¼šä¸ºä»€ä¹ˆè¿™é‡Œä½“ç°äº†{steps['step1']}çš„è¦æ±‚"
      ],
      "negative_points": [
"ç»“åˆå­¦ç”Ÿå…·ä½“è¡¨è¿°åˆ†ææ‰£åˆ†ç†ç”±ï¼šä¸ºä»€ä¹ˆè¿™é‡Œè¿èƒŒäº†{steps['step1']}çš„è¦æ±‚" 
      ],
      "improvement_suggestion": "å…·ä½“çš„æ”¹è¿›å»ºè®®ï¼Œå‘Šè¯‰å­¦ç”Ÿå¦‚ä½•ä¿®æ”¹"
    }},
    {{
      "dimension": "{steps['step2']}",
      "full_score": 30,
      "actual_score": [å…·ä½“å¾—åˆ†],
      "positive_points": ["å…·ä½“åŠ åˆ†åˆ†æ"],
      "negative_points": ["å…·ä½“æ‰£åˆ†åˆ†æ"],
      "improvement_suggestion": "å…·ä½“æ”¹è¿›å»ºè®®"
    }},
    {{
      "dimension": "{steps['step3']}",
      "full_score": 25, 
      "actual_score": [å…·ä½“å¾—åˆ†],
      "positive_points": ["å…·ä½“åŠ åˆ†åˆ†æ"],
      "negative_points": ["å…·ä½“æ‰£åˆ†åˆ†æ"],
      "improvement_suggestion": "å…·ä½“æ”¹è¿›å»ºè®®"
    }},
    {{
      "dimension": "{steps['step4']}",
      "full_score": 20,
      "actual_score": [å…·ä½“å¾—åˆ†],
      "positive_points": ["å…·ä½“åŠ åˆ†åˆ†æ"], 
      "negative_points": ["å…·ä½“æ‰£åˆ†åˆ†æ"],
      "improvement_suggestion": "å…·ä½“æ”¹è¿›å»ºè®®"
    }}
  ],
  "teacher_comments": "ï¿½ï¿½ä¸ºä¸“ä¸šé˜…å·è€å¸ˆï¼Œå¯¹è¿™ç¯‡ç­”æ¡ˆçš„æ•´ä½“å°è±¡å’Œæ ¸å¿ƒé—®é¢˜"
}}

âš ï¸ **é‡è¦æé†’**ï¼š
- æ¯ä¸ªåˆ†æå¿…é¡»å¼•ç”¨å­¦ç”Ÿçš„å…·ä½“åŸæ–‡ï¼Œä¸èƒ½ä½¿ç”¨"XXéƒ¨åˆ†"è¿™ç§æ¨¡ç³Šè¡¨è¾¾
- å¿…é¡»è¯´æ˜å…·ä½“çš„åŠ åˆ†æ‰£åˆ†ç†ç”±ï¼Œä¸èƒ½åªè¯´"åšå¾—å¥½"æˆ–"æœ‰é—®é¢˜"  
- æ”¹è¿›å»ºè®®è¦å…·ä½“å¯æ“ä½œï¼Œæœ€å¥½èƒ½ç»™å‡ºæ”¹å†™ç¤ºä¾‹
- ä¿æŒä¸“ä¸šé˜…å·è€å¸ˆçš„ä¸¥è°¨æ€§å’Œæƒå¨æ€§

ğŸ“‹ **å…³é”®JSONæ ¼å¼è¦æ±‚**ï¼š
âš ï¸ **å¿…é¡»ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONç»“æ„è¿”å›ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæ–‡æœ¬**ï¼š

```json
{
  "dimension_analysis": [
    {
      "dimension": "å®¡é¢˜æ‹†è§£",
      "full_score": 25,
      "actual_score": 20.5,
      "positive_points": ["å…·ä½“çš„åŠ åˆ†ç†ç”±1", "å…·ä½“çš„åŠ åˆ†ç†ç”±2"],
      "negative_points": ["å…·ä½“çš„æ‰£åˆ†ç†ç”±1", "å…·ä½“çš„æ‰£åˆ†ç†ç”±2"],  
      "improvement_suggestion": "å…·ä½“çš„æ”¹è¿›å»ºè®®"
    }
  ],
  "teacher_comments": "æ•´ä½“ä¸“ä¸šè¯„ä»·"
}
```

ğŸš¨ **é‡è¦**ï¼š
- åªè¿”å›JSONæ•°æ®ï¼Œä¸è¦ä»»ä½•å‰ç¼€æˆ–åç¼€æ–‡å­—
- ä¸è¦ä½¿ç”¨markdownä»£ç å—(```)åŒ…è£…
- ç¡®ä¿JSONè¯­æ³•å®Œå…¨æ­£ç¡®
- æ‰€æœ‰ä¸­æ–‡å­—ç¬¦ä¸²ç”¨åŒå¼•å·åŒ…å›´

è¯·å¼€å§‹ä¸“ä¸šæ‰¹æ”¹ï¼Œç›´æ¥è¿”å›JSONæ•°æ®ï¼š"""

    return prompt


def create_overall_evaluation_prompt(diagnosis_result: dict, essay_content: str, question_type: str) -> str:
    """
    åˆ›å»ºæ•´ä½“è¯„ä»·prompt - ç¬¬äºŒé˜¶æ®µåŸºäºè¯Šæ–­ç”Ÿæˆæ€»è¯„
    
    Args:
        diagnosis_result: ç¬¬ä¸€é˜¶æ®µçš„è¯Šæ–­ç»“æœ
        essay_content: ç”¨æˆ·ç­”é¢˜å†…å®¹
        question_type: é¢˜å‹
        
    Returns:
        str: æ•´ä½“è¯„ä»·prompt
    """
    
    prompt = f"""åŸºäºåˆšæ‰çš„ä¸“ä¸šæ‰¹æ”¹ç»“æœï¼Œè¯·ä½œä¸ºç”³è®ºä¸“å®¶è€å¸ˆæä¾›æ•´ä½“è¯„ä»·å’Œæ”¹è¿›å»ºè®®ã€‚

=== ç¬¬ä¸€é˜¶æ®µæ‰¹æ”¹ç»“æœ ===
{diagnosis_result}

=== å­¦ç”ŸåŸç­”æ¡ˆ ===  
{essay_content}

=== è¯·æä¾› ===
1. **æ€»åˆ†è®¡ç®—**ï¼šåŸºäºå››ä¸ªç»´åº¦çš„å…·ä½“å¾—åˆ†
2. **æ•´ä½“è¯„ä»·**ï¼šè¿™ç¯‡{question_type}çš„æ€»ä½“æ°´å¹³å¦‚ä½•
3. **ä¼˜å…ˆæ”¹è¿›å»ºè®®**ï¼šé’ˆå¯¹æ‰£åˆ†æœ€å¤šçš„é—®é¢˜ï¼Œæä¾›å…·ä½“æ”¹è¿›æ–¹æ¡ˆ
4. **ä¿æŒä¼˜åŠ¿**ï¼šå¯¹åŠ åˆ†ç‚¹ç»™äºˆé¼“åŠ±ï¼Œå‘Šè¯‰å­¦ç”Ÿç»§ç»­ä¿æŒ

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—ï¼š

```json
{
  "total_score": 75.5,
  "overall_evaluation": "æ•´ä½“è¯„ä»·æ–‡å­—",
  "priority_suggestions": [
    "å…·ä½“æ”¹è¿›å»ºè®®1",
    "å…·ä½“æ”¹è¿›å»ºè®®2",
    "å…·ä½“æ”¹è¿›å»ºè®®3"
  ],
  "strengths_to_maintain": [
    "ä¼˜åŠ¿ç‚¹1",
    "ä¼˜åŠ¿ç‚¹2"
  ],
  "final_comments": "æ€»ç»“æ€§è¯„è¯­"
}
```

ğŸš¨ **é‡è¦**ï¼šåªè¿”å›JSONæ•°æ®ï¼Œä¸è¦ä»»ä½•å‰ç¼€ã€åç¼€æˆ–è§£é‡Šæ–‡å­—ï¼"""

    return prompt


def get_methodology_steps(question_type: str) -> dict:
    """
    æ ¹æ®é¢˜å‹è¿”å›å¯¹åº”çš„å››æ­¥æ–¹æ³•è®ºæ­¥éª¤åç§°
    
    Args:
        question_type: ç”³è®ºé¢˜å‹
        
    Returns:
        dict: åŒ…å«å››ä¸ªæ­¥éª¤åç§°çš„å­—å…¸
    """
    
    steps_mapping = {
        "æ¦‚æ‹¬é¢˜": {
            "step1": "å®¡é¢˜å®šæ ‡",
            "step2": "ç²¾å‡†æ‰¾ç‚¹", 
            "step3": "é€»è¾‘å½’å¹¶",
            "step4": "è§„èŒƒæˆæ–‡"
        },
        "ç»¼åˆåˆ†æé¢˜": {
            "step1": "å®¡é¢˜æ‹†è§£",
            "step2": "æœå¯»ç»„ä»¶",
            "step3": "é€»è¾‘é‡æ„", 
            "step4": "è§„èŒƒä½œç­”"
        },
        "å¯¹ç­–é¢˜": {
            "step1": "ç²¾å‡†é—®é¢˜è¯Šæ–­",
            "step2": "è§’è‰²å®šä½ä¸è§†è§’é”å®š",
            "step3": "ä»ææ–™ä¸­å¯»æ‰¾å¯¹ç­–æ¥æº",
            "step4": "ç»“æ„åŒ–ä¸åŠ¨è¯åŒ–å‘ˆç°"
        },
        "åº”ç”¨æ–‡å†™ä½œé¢˜": {
            "step1": "æƒ…å¢ƒè§£æ„ï¼ˆé»„é‡‘ä¸‰é—®ï¼‰",
            "step2": "æ ¼å¼éµä»",
            "step3": "å†…å®¹ç»„ç»‡ä¸é€»è¾‘æ„å»º",
            "step4": "è¯­è¨€é£æ ¼ä¸è¯­æ°”åŒ¹é…"
        }
    }
    
    return steps_mapping.get(question_type, {
        "step1": "èƒ½åŠ›ç»´åº¦ä¸€",
        "step2": "èƒ½åŠ›ç»´åº¦äºŒ", 
        "step3": "èƒ½åŠ›ç»´åº¦ä¸‰",
        "step4": "èƒ½åŠ›ç»´åº¦å››"
    })
